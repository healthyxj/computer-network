# 一、具体构成

<b>网络由若干节点和连接这些节点的链路</b>组成。<b>互联网(internet)是网络的网络，因特网(Internet，I是大写的)是最大的互联网</b>。目前三种网络是电话-电视-互联网，网络的特性是**连通性和共享性**。

因特网发展的三个阶段：

* <b>单个ARPANET向互联网</b>发展的过程：TCP/IP协议成为ARPANET上的标准协议，1983年是因特网的诞生时间。
* 建成了三级结构的因特网：<b>主干网(电信、移动等)、地区网、校园网(企业网)</b>
* 多层次ISP阶段：有互联网服务提供商(ISP)、因特网交换点(IXP)

什么是因特网？回答问题的方式有两种：能够描述因特网的具体构成，即**构成因特网的基本硬件和软件**；能够**根据为分布式应用提供服务的联网基础设施来描述互联网**

从工作方式来看，因特网分为<b>边缘部分</b>(由所有连接在因特网上的主机组成，由用户直接使用，用于进行通信和资源共享)和<b>核心部分</b>(由大量网络和连接这些网络的路由器组成，为边缘部分提供服务)。

主机A和主机B进行通信，实际上是运行在主机A上的某个程序和运行在主机B上的某个程序进行通信。即<b>主机A的某个进程和主机B上的另一个进程进行通信</b>

网络边缘的端系统中运行的程序之间的通信可以分为两大类：<b>客户-服务器方式(Client&Server)和对等(Peer-to-peer)方式</b>.客户是服务的请求方，服务器是服务的提供方。服务器启动后即自动调用并一直不断地运行，被动地等待并接受来自各地的客户的通信请求。

## 1、具体构成描述

具体构成描述来说，<b>互联网是由有通信能力的设备连接而成的</b>。电脑这些设备称为主机or端系统。**端系统通过通信链路和分组交换机连接到一起。**当一台端系统向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节。以此形成的信息包用计算机网络的术语来说是分组。分组被发送到目的端系统后，在那里被装配成初始数据。分组交换机从它的一条入通信链路接受到达的分组，并从一条出链路转发该分组。

**分组交换机主要包括路由器和链路层分组交换机**。<b>链路层分组交换机接入到网络中，而路由器处于网络核心。</b>从发送端到接收端系统，一个分组经过的一系列通信链路和分组交换机称为路径。

<b>端系统通过互联网服务提供商接入到互联网中</b>。每个ISP都是由多台分组交换机和多段通信链路组成的网络。ISP为端系统提供因特网接入服务，如DSL住宅宽带接入、高速局域网接入和移动无线接入。ISP也为内容提供者直接连入因特网，如web站点和视频服务器直接连入因特网。ISP也是互联的，较低层级的ISP通过国家国际级的ISP连接。不同层级的ISP都是分别独自管理的。

IP协议定义了在路由器和端系统之间发送和接受的分组格式。

因特网标准是由因特网工程任务组(IETF)研发。IETF的标准文档为请求评论(RFC)

## 2、服务描述

<b>涉及到多个相互交换数据的端系统，称为分布式应用程序。因特网的应用程序运行在端系统上，并不是运行在网络核心的分组交换机中</b>。套接字接口规定了运行在一个端系统上的程序请求因特网基础设施向运行在另一个端系统上的特定目的地程序交付数据的方式。即**套接字接口是一套发送程序必须遵循的规则集合。**

## 3、协议

类比于人类活动，比如对话，你好，你好，几点了，十点了；或者老师询问同学有什么问题时，同学举起手，老师允许学生提问，学生提问。在因特网中，涉及到两个或多个远程通信实体的所有活动都受协议的制约。协议定义了两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和接收一条报文或其他事件所采取的动作。

熟悉的协议：计算机向Web服务器发送一条连接请求报文，并等待回答。web服务器将最终能接收到连接请求报文，并返回一条连接响应报文。得知请求该web文档正常以后，计算机在一条get报文中发送要从这台web服务器上取回的网页的名字。最后，web服务器向计算机返回该web网页。

# 二、网络边缘

## 接入网AN(Access Network)

<b>接入网是将端系统物理连接到边缘路由器的网络</b>。边缘路由器是端系统到任何其它远程端系统的路径上的<b>第一台路由器</b>。

### 1、家庭接入

宽带住宅入户有两种最流行的类型：数字用户线和电缆。

#### a、数字用户线(DSL)-双绞铜线

住户通常<b>从提供本地电话接入的本地电话公司处获得DSL因特网接入</b>。使用DSL时，用户的本地电话公司就是他的ISP。

**每个用户的DSL调制解调器使用现有的电话线（双绞铜线）与位于电话公司中心局中的数字用户接入复用器(DSLAM)交换数据**。家庭的DSL调制解调器得到数字数据后将其转化为高频音，以通过电话线传输给本地中心局。

家庭电话线同时承担了数据和电话信号，用不同的频率进行编码：<b>高速下行信道(50kHz-1MHz),中速上行信道(4kHz-50kHz),普通的双向电话信道(0-4kHz)</b>。一个电话呼叫和一个因特网连接能够同时共享DSL线路。用户一侧，一个分配器把到达家庭的数据信号和电话信号隔开，并将数据信号转发给DSL调制解调器。而**电话公司一侧，本地中心局，DSLAM将数据和电话信号分开，将数据送到因特网中**。

DSL定义了多个传输速率，包括12Mbps下行和1.8Mbps上行传输速率（1999）和55Mbps下行和15Mbps上行传输速率（2006），上行和下行的速率不等，因此这种接入为<b>非对称</b>的。因为家庭与本地中心局之间的距离、双绞线的规格和电气干扰的程度使最大速率受到限制。ADSL非对称数字用户线路，需要调制解调器(modem),进行<b>数字信号和模拟信号的转换</b>,因为电话线只能传递模拟信号。

#### b、电缆因特网接入(cable internet access)-混合光纤(HFC)

电缆因特网接入利用了有线电视公司现有的有线电视基础设施。<b>住宅从提供有线电视的公司获得了电缆因特网接入</b>。

光缆将电缆头端接到地区枢纽，从这里使用传统的同轴电缆到达各家各户。使用的是光纤和同轴电缆，也称混和光纤同轴电缆系统。电缆因特网接入需要特殊的调制解调器，为电缆调制解调器，通过一个以太网端口连接到家庭PC。电缆头端的电缆调制解调器端接系统(cable modem termination system，CMTS)与DSLAM有类似的功能。

电缆因特网接入的重要特征是**共享广播媒体。由头端发送的每个分组向下行经每段链路到每个家庭，每个家庭发送的每个分组经上行信道向头端传输。**

```
共享广播媒体意味着如果几个用户同时经下行信道下载一个视频文件，每个用户接收视频文件的实际速率将大大低于电缆总计的下行速率。
```

####  c、光纤到户(Fiber To The Home,FFTH)

新兴的技术是光纤到户。<b>每根光纤由许多家庭共享，直到相对接近这些家庭的位置，光纤才分成每户一根</b>。

光纤的分配有两种竞争性的光线分布体系结构：主动光纤网络(AON)和被动光纤网络(PON)。

PON体系中，<b>每个家庭有一个光纤网络端接器(ONT)</b>，由专门的光纤连接到临近的分配器。该分配器把一些家庭集结到一根共享的光纤，该光纤再连接到本地电话公司和公司的<b>中心局中的光纤线路端接器（OLT）</b>。OLT提供了光信号和电信号之间的转换。在PON体系中，所有从OLT发送到分配器的分组在分配器处复制。

### 2、企业（和家庭）接入

用**局域网**将端系统连接到边缘路由器。<b>以太网是目前公司、大学和家庭网络最为流行的接入技术</b>。

此外，基于IEEE802.11技术的无线LAN接入，俗称WIFI，几乎无处不在。

### 3、广域无线接入

3G和LTE iphone和安卓<b>应用了与蜂窝移动电话相同的无线基础设施，通过蜂窝网提供商运营的基站来发送和接收分组</b>。

**与WIFI不同，一名用户只需位于基站的几万米之内。**

## 物理媒体

<b>HFC使用光缆和同轴电缆；DSL和以太网使用双绞铜线；移动接入网络使用无线电频谱</b>；

```
如何定义媒体表示的内容，可以通过思考一个比特的历程。
一个比特从一个端系统开始传输，通过一系列链路和路由器，到达另一个端系统。中间的链路和路由器就是一个发射器-接收器对，对于每一个发射器-接收器对，就跨越了一种物理媒体，物理媒体能够传播电磁波或光脉冲来发送那个比特。
```

物理媒体包括双绞铜线、同轴电缆、多模光纤电缆、陆地无线电频谱和卫星无线电频谱。<b>物理媒体分为两种类型:导引型媒体和非导引型媒体</b>。导引型媒体，电波沿着固体媒体前行，如**光缆、双绞铜线、同轴电缆**。非引导型媒体，电波在空气或外层空间中传播，如**无线局域网或数字卫星频道**。

### 1、双绞铜线

 最便宜并且最常用的导引型传输媒体是双绞铜线。 双绞线是由两根绝缘的铜线组成，以规则的螺旋状排列，两根线被绞合起来，一减少临近类似的双绞线上的电气干扰。许多双绞线捆扎在一起形成了一个通信链路。<b>无屏蔽双绞线(UTP)常用于建筑物内的计算机网络中，即局域网中</b>。

双绞铜线的数据传输速率取决于线的粗细以及传输方和接收方之间的距离。

### 2、同轴电缆

同轴电缆由两个同心的铜导体组成。

同轴电缆能够被用作导引型<b>共享</b>媒体。许多端系统能够直接与该电缆相连，每个端系统都能够接收由其他端系统发送的内容。

### 3、光纤

光纤细而柔软，能导引光脉冲，每个脉冲表示一个比特。

特点：速率高、不受电磁干扰、衰减极低

用作因特网的主干

### 4、陆地无线电信道

无线电信道承载电磁频谱中的信号。

环境上考虑路径损耗和遮挡衰落、多径衰落、干扰。大致划分为三类：一类运行在很短距离(1米或2米)；一类运行在局域，跨越数十到数百米；第三类运行在广域，跨越数万米。

# 三、网络核心

## 分组交换

端系统彼此交换报文(message),为了从源端系统向目的端系统发送报文，源将长报文划分成较小的数据段，为分组(Packet)。

交换机主要有路由器和链路层交换机。<b>路由器是实现分组交换的关键构件，任务是转发收到的分组</b>，这是网络核心部分最重要的功能。

特点

* 高效，<b>动态分配传输带宽，对通信链路是逐段占用</b>
* 灵活，以分组为传送单位和查找路由
* 迅速，不必先建立连接就能向其他主机发送分组
* 可靠，保证可靠性的网络协议；分布式的路由选择协议使网络有更好的生存性

### 存储转发传输

交换机能够开始向输出链路传输该分组的第一个比特之前，必须先接收到整个分组。因此有缓存，存储分组的比特。

通过N条速率为R的链路组成的路径，即有N-1台路由器，端到端的时延：N*L/R

### 排队时延和分组丢失

分组交换机有输出缓存output buffer，也叫输出队列output queue。

如果到达的分组发现缓存已经被等待传输的分组完全充满，就会发生分组丢失(丢包)。

### 转发表和路由选择协议

路由器中的<b>输入和输出端口之间没有直接相连</b>.路由器处理分组时，先把收到的分组放入缓存。查找转发表，找到某个目的地址，再把分组送到适当的端口转发出去。

当一个分组到达网络中的路由器，路由器检查该分组的目的地址的一部分，并向一台相邻路由器转发该分组。路由器内部有转发表。

路由器有路由选择协议，用于自动设置这些转发表。

## 电路交换

电路交换能够<b>预留端系统间沿路径通信所需要的资源</b>(缓存，链路传输速率)。当两台主机要通信时，网络会在两台主机之间创建一条专用的端到端连接。如果有4条链路，就只能获得总传输容量的1/4.通话过程中，通信双方一直占用所建立的连接，直到通话结束。

链路中的电路是通过<b>频分复用(Frequency-Division Multiplexing)或时分复用(Time-Division Multiplexing)</b>来实现的。带宽指数字信道能传送的最大速率

电话网络中每个频段的宽度通常为4kHz，这个频段的宽度称为带宽(bandwidth).对于<b>频分复用，频率被分为4个频段，每个频段的带宽是4kHz</b>。对于TDM，时域被分成帧，在每个帧中有4个时隙。对于<b>TDM,一条电路中的传输速率等于帧速率*一个时隙中的比特数量</b>。如链路每秒传输8000个帧，每个时隙由8个比特组成，每条电路的传输速率为64kbps。

~~~
因此FDM中的频段≈TDM中的时隙
~~~

## 比较分组交换和电路交换

电路交换预分配传输链路，而分组交换按需分配链路的使用。

## 网络的网络

第一层ISP(tier-1 ISP)，存在点(Point of Presence)、多宿(multi-home，任何ISP可以与两个或更多ISP提供商连接)

为减少费用，位于<b>相同等级结构层次</b>的邻近一对ISP能够对等。能够**直接将他们的网络连接到一起**，使他们之间的流量经直接连接，不用通过上游的ISP传输。

第三方公司能够创建一个<b>因特网交换点(internet exchange point,IXP),IXP是一个汇合点，用于多个ISP在这里对等</b>。

~~~
较低层的ISP与较高层的ISP相连，较高层ISP彼此互联。用户和内容提供商是较低层ISP的客户，较低层ISP是较高层ISP的客户。
~~~

# 四、时延、丢包和吞吐量

## 1、时延

节点处理时延(nodal processing delay)、排队时延(queuing delay)、传输时延(transmission delay)、传播时延(propagation delay)加起来是节点总时延。

### 处理时延

检查分组首部和决定将该分组导向何处所需要的时间

### 排队时延

一个特定分组的排队时延长度将取决于先期到达的**正在排队等待向链路传输的分组的数量**。

### 传输时延

分组以先到先服务的方式传输。传输时延可以说是发射时延。是将**所有分组的比特发送到链路所需要的时间**。L表示分组的长度，R表示链路传输速率。

### 传播时延

从**路由器A的链路的起点到路由器B**的传播需要的时间。在广域网中，传播时延为毫秒级。

节点的总时延=处理时延+排队时延+传输时延+传播时延。对于**高速网络链路**，提高的是数据发送速率(**减少了传输时延**)

**时延带宽积=传播时延*带宽**

## 2、排队时延和丢包

a表示分组到达队列的平均速率(a的单位是分组/秒，即pkt/s)，R是传输速率。假定所有分组都是由L比特组成的。则La/R表示流量强度。设计系统时，<b>流量强度不能大于1</b>.随着流量强度无限接近于1，排队时延无限增加。

丢包是指如果到达的分组发现没有地方存储这个分组，就会发生的现象。

## 3、端到端时延

假设源主机到目的主机之间有N-1台路由器，网络无拥堵。在每台路由器和主机的处理时延为dproc，每台主机和路由器的输出速率为Rbps，传播时延为dprop。则端到端时延为N(dproc+dprop+L/R)

## 4、吞吐量

瞬时吞吐量(instaneous throughput)是主机接收到文件的速率。如果**文件由F比特组成，主机收到所有比特用去T秒，则平均吞吐量为F/T bps**。吞吐量是单位时间内通过某个网络的数据量。

吞吐量一般是瓶颈链路(bottleneck link)的速率。**当数据传输的速率R远大于路由器发送的速率Rs和主机接收的速率Rc，瓶颈链路为路由器或主机这些接入网**；数据传输的速率与路由器和主机的速率在同一量级，瓶颈链路为数据传输链路。

## 5、信道利用率

某信道有百分之几的时间是被利用的，网络利用率是全网络的信道利用率的加权平均值。

信道利用率不是越高越好，会增加时延。

# 五、协议层次及模型

对于大而复杂且需要不断更新的系统，改变服务的实现而不影响其他组件是分层的一个重要优点。

## 1、协议分层

网络设计者以分层的方式组织协议以及实现这些协议的网络硬件和软件。我们关注某层向它上一层提供的服务(service)，即所谓的一层的服务模型。

协议分层有**概念化和结构化**的优点。

## 2、封装(encapsulation)

自顶向下，运输层封装了应用层的报文。

# 六、受到攻击的网络

## 1、有害程序

恶意软件(malware)，僵尸网络(botnet)，

病毒，virus，是一种需要某种形式的用户交互来感染用户设备的恶意软件。

蠕虫，worm，不需要任何形式的用户交互就能进入设备的恶意软件。

## 2、服务器和网络基础设施

拒绝攻击服务(Denial-of-Service,Dos attack)使网络、主机等不能被合法用户所使用。

* 弱点攻击
  * 向目标主机上**易受攻击**的程序或操作系统发送制作精细的报文。
* 带宽洪泛
  * 发送大量的分组
* 连接洪泛
  * 在目标主机创建大量的半开或全开的TCP连接

如果是单一发送的，能够被上游路由器发现并拦截。因此演变出了分布式拒绝服务攻击(DDos)

## 3、嗅探分组

在无线传输设备附近放一台被动的接收机，能得到传输的每个分组的副本。被动，难以被检验，要防范只能通过密码学。





