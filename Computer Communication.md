# 一、通信基础
一开始是得知对方的<b>IP地址</b>。

最终是根据<b>MAC地址(网卡地址)</b>，输送数据到网卡，被网卡接收。如果网卡发现数据的目标MAC地址是自己，就会将数据传递给上一层进行处理；<b>如果目标MAC地址不是自己，会将数据丢弃，不会传递给上一层</b>。

一个网卡一个MAC地址，获取MAC地址后，会存入，成为ARP缓存

# 二、计算机之间的连接方式
为便于理解，使用Packet Tracer进行模拟仿真。

一些常用的英文单词：switch交换机，router路由器，hub集线器

## 1、网线直连(交叉线)
选中end devices(终端设备)-PC，在工作区放置两台PC。再选中闪电形状的link(连接)，闪电形状是默认生成的。双击PC，打开计算机相关的内容，选中桌面，IP配置。IPv4，填入192.168.1.10，子网掩码按下tab键就自动生成。关闭就算保存了。另一台IP地址设为192.168.1.11.然后在第一台PC上，打开桌面-命令提示符，输入ping 192.168.1.11.能发现能够ping通

点击仿真，将左上角的PDU拖到一个PC上，再点击另一台PC，就会发现能够发送数据包。在右侧的仿真点击计算机，就能看到OSI模型上的内容。实际上，是因为<b>第一次ping通之后，记住了另一台PC的MAC地址</b>。获取的MAC地址会存入ARP缓存中。

如果只知道IP地址，不知道MAC地址，就会<b>采用ARP协议，发送一个广播</b>。广播是<b>在同一个网段中传播</b>的，不同网段之间是不能传播的。发送广播的目的，是知道目的主机的MAC地址。MAC地址若为<b>FFFF.FFFF.FFFF</b>，表示是全1，即为广播。

## 2、同轴电缆(coaxial)
同轴电缆用于连接多台PC。

特点

* 半双工通信：同一时间只允许一个方向发送数据
* 容易冲突：两台及以上的PC发送请求时，会造成冲突
* 不安全
* 中间断了，网络就坍了

## 3、集线器(hub)
集线器之间可以互相连接来增加连接数目。

特点

* 半双工通信
* 容易冲突
* 不安全
* 跟同轴电缆一样，没有智商

~~~
可以通过arp -a查看当前PC存储的arp缓存，arp缓存记录了缓存主机的IP地址和MAC地址
~~~

## 4、 网桥(bridge)
同样连接同一网段

能够<b>通过自学习得知每个接口那侧的MAC地址</b>，从而起到隔绝冲突域的作用。隔绝冲突域的意思是在网桥的两侧，如果同时发送请求，不会产生冲突。

但是接口少

## 5、交换机(switch)
交换机相当于接口更多的网桥，<b>交换机≈集线器+网桥</b>

全双工通信

二层交换机无IP地址，三层交换机有IP地址

<b>组建局域网，需要交换机。</b>

~~~
网线直连、同轴电缆、集线器、网桥、交换机
连接的设备需要在同一网段
连接的设备要在同一广播域，广播域意味着某一台机器发了一个广播，同一网段的机器都能够收到

路由器
可以在不同网段之间转发数据
隔绝广播域
~~~

## 6、路由器(router)
主机发送请求之前，首先要判断<b>目标主机的IP地址是否与该主机在同一网段</b>

* 若在<b>同一网段上，则通过ARP协议</b>，经过集线器、交换机等设备传递数据

* 若<b>不在同一网段上，则通过路由器</b>转发数据

路由器连接几个网段，就有几个网关，<b>网关与所连的广播域的网段相同</b>,源主机需要配置默认网关(网段最后位为1)

### 具体流程

假如路由器一端的主机要发送数据到另一端的主机，首先源主机先发送一个arp广播，该广播发送到路由器的IP地址后，路由器把自身的的MAC地址发送回源主机。源主机得知了MAC地址后，就发送数据。数据到达路由器后，由路由器发送arp广播，arp广播到达目标主机后，目标主机发送MAC地址会路由器，最终传递回源主机。

通过packet tracer查看路由器的端口，在菜单栏选择选项-首选项-在逻辑工作区总是显示端口标签。点击路由器，选择物理，可以看到有快速以太网(FastEthernet)、串口(serial)

# 三、IP地址、子网掩码与默认网关
## 1、MAC地址
每一个网卡都有一个6字节的MAC地址(Media Access Control Address)。每个网卡的MAC地址都唯一，固化在网卡的ROM中，由IEEE802标准规定。<b>前三个字节为OUI(Organization Unique Identifier)，组织标识符</b>，由IEEE的注册管理机构分配给厂商；后3个字节是网络接口标识符，由厂商自行分配。

windows是杠隔开，类unix系统是由冒号隔开。48位全为1时，即FF-FF-FF-FF，代表广播地址。

查看MAC地址，ipconfig -all

修改MAC地址：点击打开“网络和Internet”设置-更改适配器选项-属性-配置-高级-网络地址，修改不存在为值，填写值的时候要将-去掉。

有时可以通过修改MAC地址进行蹭网。

arp -d 删除ARP缓存中的所有内容

## 2、IP地址
IP地址(Internet Protocol Address)：互联网上每一个主机都有一个IP地址。最初是IPv4版本，32bit(4字节)，但是不够用，就推出了IPv6版本，128bit(16字节)

不指定版本，默认是IPv4版本，后面再单独讨论IPv6版本。

<b>按字节(1字节有8个二进制位)来分，可以分为4部分</b>，即192.168.1.10

IP地址：192.168.1.10

子网掩码：255.255.255.0

IP地址由网络ID和主机ID组成,网络ID与主机ID的区分关系到网段。

<b>网段是IP地址&子网掩码</b>,

  1100 0000.1010 1000.0000 0001.0000 1010

&1111 1111.1111 1111.1111 1111.0000 0000

---

  1100 0000.1010 1000.0000 0001.0000 0000

即网段为192.168.1.0，所以192.168.1为网络ID，10为主机ID。IP地址的<b>主机位不能全部为0或者全部为1(这里指二进制位，换算一下就是255)</b>

如果要跨网段发送数据，就需要网关。路由器上的IP配置就是网关，<b>网关末位最好设置为1</b>,不容易超时。

### IP地址分类

A类地址，默认子网掩码为255.0.0.0；后24位为主机ID，<b>网络ID以0开头</b>，所以<b>网络ID部分为0-127</b>，127.0.0.1为本地环回地址(lookback)，代表本机地址

B类地址：默认子网掩码为255.255.0.0；后18位为主机标识，<b>网络ID要以10开头</b>，所以网络ID部分为128-191.0-255，

C类地址：默认子网掩码为255.255.255.0，<b>网络ID必须以110开头</b>，所以网络ID为192-223.0-255.0-255

D类地址：以1110开头，为多播地址，224-239

E类地址：以1111开头，保留为今后使用，240-255

只有ABC类地址才会分配给主机。网段处为255，表示广播段。<b>默认不代表一定，可以随具体情况改变。</b>

## 3、子网掩码
子网掩码的CIDR表示方法，CIDR(Classless Inter-Domain Routing):无类别域间路由

<b>192.168.1.100/24,表示子网掩码有24个1</b>，即255.255.255.0

进行子网划分的原因

要让500台主机在同一网段内，分配一个C类网段肯定是不可行的，起码得B类网段。但是B类网段有65536-2个，造成了网段的浪费。这种情况下就可以采用子网划分，借助主机位作子网维，划分出多个子网。

### 等长子网划分（重点！！！！！！）

本来的C类网段：192.168.0.0/24 划分成2个子网段

从主机位拿出一位最高位当作网络ID，即

A子网：192.168.0.0000 0000->192.168.0.0/25

B子网：192.168.0.1000 0000->192.168.0.128/25

此时的<b>子网掩码均为255.255.255.128</b>，A的主机位为1-126，B的主机位为129-254

等分成4个子网，子网掩码往后移动2位。

<b>网关跟主机位类似，必须为合理的IP地址</b>，因此A网管可以设置为192.168.0.1，B网关可以设置为192.168.0.129

<b>注意区分网段与子网段</b>

10.172.168.1/8 A类网段

10.172.168.1/16A类子网段

~~~
建议从子网掩码入手
划分子网段时，先确定子网掩码。若划分为两个子网段，则从主机位拿出一位。一个为0，一个为1，确定两个主机IP地址的范围.将拿来的主机位全部置1，从而确定两个主机的子网掩码(这些主机的子网掩码应该是相同的)。
子网掩码确定后，选择中间的数作为主机位，从而获得主机的IP地址。一般选择IP地址对应的网段加1作为默认网关。

设置路由器(网关)
路由器的子网掩码同样设置为给出的主机位全部置1时的子网掩码。路由器的IP地址设置为对应侧的末位+1的网段。
~~~

2子网段的连接
|          |       PC1       |    路由器fa0    |    路由器fa1    |       PC2       |
| :------: | :-------------: | :-------------: | :-------------: | :-------------: |
|  IP地址  |  192.168.0.11   |   192.168.0.1   |  192.168.0.129  |  192.168.0.130  |
| 子网掩码 | 255.255.255.128 | 255.255.255.128 | 255.255.255.128 | 255.255.255.128 |
| 默认网关 |   192.168.0.1   |                 |                 |  192.168.0.129  |

在Packet Tracer上模拟时，注意要将端口状态设置为开。
